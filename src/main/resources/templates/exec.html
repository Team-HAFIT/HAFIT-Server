<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <!-- Require the peer dependencies of pose-detection. -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>

  <!-- You must explicitly require a TF.js backend if you're not using the TF.js union bundle. -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
  <!-- Alternatively you can use the WASM backend: <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm/dist/tf-backend-wasm.js"></script> -->

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/addons/p5.sound.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/resources/css/style.css">
  <meta charset="utf-8"/>
</head>
<body>
<script src="/resources/js/webcam.js"></script>

<!--&lt;!&ndash; 데이터 저장 버튼 &ndash;&gt;-->
<!--<button id="save-button">Save JSON data</button>-->

<!--&lt;!&ndash; JSON 데이터 출력 버튼 &ndash;&gt;-->
<!--<button id="show-button">Show JSON data</button>-->
<!--<ul id="json-list">-->
<!--    <li id="count">count :</li>-->
<!--    <li id="score">score :</li>-->
<!--    <li id="bad">bad :</li>-->
<!--</ul>-->

<!--<button id="end-button" onclick="submitForm()">end data</button>-->
<button id="end-button">end button</button>
<script>

<!--    // JSON 데이터 생성-->

<!--    // 데이터 저장 버튼 클릭 이벤트 처리-->
<!--    const saveButton = document.querySelector('#save-button');-->
<!--    saveButton.addEventListener('click', function() {-->
<!--        // JSON 데이터를 로컬 스토리지에 저장-->
<!--        localStorage.setItem('myData', JSON.stringify(data));-->
<!--    });-->

<!--    // JSON 데이터 출력 버튼 클릭 이벤트 처리-->
<!--    const showButton = document.querySelector('#show-button');-->
<!--    showButton.addEventListener('click', function() {-->
<!--        const dataArray = Object.entries(data);-->

<!--        // 배열의 각 요소를 li 태그로 만들어 ul 태그에 추가-->
<!--        const jsonList = document.querySelector('#json-list');-->
<!--        dataArray.forEach(([key, value]) => {-->
<!--            document.getElementById(`${key}`).innerText = `${key} : ${value}`;-->
<!--        });-->
<!--    });-->

<!--    function submitForm() {-->
<!--        var xhr = new XMLHttpRequest();-->
<!--        xhr.open("POST", "submit");-->
<!--        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");-->
<!--        xhr.send(JSON.stringify(data));-->
<!--    }-->

    document.getElementById("end-button").addEventListener("click", function() {
        exportCSV(keypointNames, keypointsData);
        const data = {
            'count' : (squatCount+((currentSet-1)*repsPerSet)),
            'score' : score,
            'bad' : bad
        };
        var form = document.createElement("form"); // form 요소 생성
        form.method = "POST"; // 전송 방식을 POST로 설정
        form.action = "submit"; // 전송할 페이지 URL을 지정
        form.enctype = "multipart/form-data";

        var input = document.createElement("input"); // input 요소 생성
        input.type = "hidden"; // input 타입을 hidden으로 설정
        input.name = "data"; // 전송할 데이터의 이름을 "data"로 지정
        input.value = JSON.stringify(data); // 전송할 JSON 데이터를 value로 지정
        form.appendChild(input); // input 요소를 form 요소에 추가

        document.body.appendChild(form); // form 요소를 body 요소에 추가
        form.submit(); // form 요소를 submit하여 페이지를 이동하고 데이터를 전송
    });
</script>
</body>
</html>